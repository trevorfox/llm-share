{"version":3,"file":"widget.iife.js","sources":["../src/icons/index.ts","../src/config/defaults.ts","../src/config/schema.ts","../src/utils/uuid.ts","../src/events/tracker.ts","../src/ui/styles.ts","../src/utils/browser.ts","../src/utils/clipboard.ts","../src/ui/Button.ts","../src/utils/share.ts","../src/utils/prompt.ts","../src/ui/Widget.ts","../src/widget.ts"],"sourcesContent":["/**\n * LLM icon SVGs (inline)\n */\n\nexport const CHATGPT_ICON = `<svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n<title>OpenAI icon</title>\n<path d=\"M22.2819 9.8211a5.9847 5.9847 0 0 0-.5157-4.9108 6.0462 6.0462 0 0 0-6.5098-2.9A6.0651 6.0651 0 0 0 4.9807 4.1818a5.9847 5.9847 0 0 0-3.9977 2.9 6.0462 6.0462 0 0 0 .7427 7.0966 5.98 5.98 0 0 0 .511 4.9107 6.051 6.051 0 0 0 6.5146 2.9001A5.9847 5.9847 0 0 0 13.2599 24a6.0557 6.0557 0 0 0 5.7718-4.2058 5.9894 5.9894 0 0 0 3.9977-2.9001 6.0557 6.0557 0 0 0-.7475-7.0729zm-9.022 12.6081a4.4755 4.4755 0 0 1-2.8764-1.0408l.1419-.0804 4.7783-2.7582a.7948.7948 0 0 0 .3927-.6813v-6.7369l2.02 1.1686a.071.071 0 0 1 .038.052v5.5826a4.504 4.504 0 0 1-4.4945 4.4944zm-9.6607-4.1254a4.4708 4.4708 0 0 1-.5346-3.0137l.142.0852 4.783 2.7582a.7712.7712 0 0 0 .7806 0l5.8428-3.3685v2.3324a.0804.0804 0 0 1-.0332.0615L9.74 19.9502a4.4992 4.4992 0 0 1-6.1408-1.6464zM2.3408 7.8956a4.485 4.485 0 0 1 2.3655-1.9728V11.6a.7664.7664 0 0 0 .3879.6765l5.8144 3.3543-2.0201 1.1685a.0757.0757 0 0 1-.071 0l-4.8303-2.7865A4.504 4.504 0 0 1 2.3408 7.872zm16.5963 3.8558L13.1038 8.364 15.1192 7.2a.0757.0757 0 0 1 .071 0l4.8303 2.7913a4.4944 4.4944 0 0 1-.6765 8.1042v-5.6772a.79.79 0 0 0-.407-.667zm2.0107-3.0231l-.142-.0852-4.7735-2.7818a.7759.7759 0 0 0-.7854 0L9.409 9.2297V6.8974a.0662.0662 0 0 1 .0284-.0615l4.8303-2.7866a4.4992 4.4992 0 0 1 6.6802 4.66zM8.3065 12.863l-2.02-1.1638a.0804.0804 0 0 1-.038-.0567V6.0742a4.4992 4.4992 0 0 1 7.3757-3.4537l-.142.0805L8.704 5.459a.7948.7948 0 0 0-.3927.6813zm1.0976-2.3654l2.602-1.4998 2.6069 1.4998v2.9994l-2.5974 1.4997-2.6067-1.4997Z\" fill=\"currentColor\"/>\n</svg>`;\n\nexport const CLAUDE_ICON = `<svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n<title>Claude</title>\n<path d=\"M4.709 15.955l4.72-2.647.08-.23-.08-.128H9.2l-.79-.048-2.698-.073-2.339-.097-2.266-.122-.571-.121L0 11.784l.055-.352.48-.321.686.06 1.52.103 2.278.158 1.652.097 2.449.255h.389l.055-.157-.134-.098-.103-.097-2.358-1.596-2.552-1.688-1.336-.972-.724-.491-.364-.462-.158-1.008.656-.722.881.06.225.061.893.686 1.908 1.476 2.491 1.833.365.304.145-.103.019-.073-.164-.274-1.355-2.446-1.446-2.49-.644-1.032-.17-.619a2.97 2.97 0 01-.104-.729L6.283.134 6.696 0l.996.134.42.364.62 1.414 1.002 2.229 1.555 3.03.456.898.243.832.091.255h.158V9.01l.128-1.706.237-2.095.23-2.695.08-.76.376-.91.747-.492.584.28.48.685-.067.444-.286 1.851-.559 2.903-.364 1.942h.212l.243-.242.985-1.306 1.652-2.064.73-.82.85-.904.547-.431h1.033l.76 1.129-.34 1.166-1.064 1.347-.881 1.142-1.264 1.7-.79 1.36.073.11.188-.02 2.856-.606 1.543-.28 1.841-.315.833.388.091.395-.328.807-1.969.486-2.309.462-3.439.813-.042.03.049.061 1.549.146.662.036h1.622l3.02.225.79.522.474.638-.079.485-1.215.62-1.64-.389-3.829-.91-1.312-.329h-.182v.11l1.093 1.068 2.006 1.81 2.509 2.33.127.578-.322.455-.34-.049-2.205-1.657-.851-.747-1.926-1.62h-.128v.17l.444.649 2.345 3.521.122 1.08-.17.353-.608.213-.668-.122-1.374-1.925-1.415-2.167-1.143-1.943-.14.08-.674 7.254-.316.37-.729.28-.607-.461-.322-.747.322-1.476.389-1.924.315-1.53.286-1.9.17-.632-.012-.042-.14.018-1.434 1.967-2.18 2.945-1.726 1.845-.414.164-.717-.37.067-.662.401-.589 2.388-3.036 1.44-1.882.93-1.086-.006-.158h-.055L4.132 18.56l-1.13.146-.487-.456.061-.746.231-.243 1.908-1.312-.006.006z\" fill=\"currentColor\" fill-rule=\"evenodd\"/>\n</svg>`;\n\nexport const GEMINI_ICON = `<svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n<title>Gemini</title>\n<path d=\"M20.616 10.835a14.147 14.147 0 01-4.45-3.001 14.111 14.111 0 01-3.678-6.452.503.503 0 00-.975 0 14.134 14.134 0 01-3.679 6.452 14.155 14.155 0 01-4.45 3.001c-.65.28-1.318.505-2.002.678a.502.502 0 000 .975c.684.172 1.35.397 2.002.677a14.147 14.147 0 014.45 3.001 14.112 14.112 0 013.679 6.453.502.502 0 00.975 0c.172-.685.397-1.351.677-2.003a14.145 14.145 0 013.001-4.45 14.113 14.113 0 016.453-3.678.503.503 0 000-.975 13.245 13.245 0 01-2.003-.678z\" fill=\"currentColor\" fill-rule=\"evenodd\"/>\n</svg>`;\n\nexport const PERPLEXITY_ICON = `<svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n<title>Perplexity</title>\n<path d=\"M19.785 0v7.272H22.5V17.62h-2.935V24l-7.037-6.194v6.145h-1.091v-6.152L4.392 24v-6.465H1.5V7.188h2.884V0l7.053 6.494V.19h1.09v6.49L19.786 0zm-7.257 9.044v7.319l5.946 5.234V14.44l-5.946-5.397zm-1.099-.08l-5.946 5.398v7.235l5.946-5.234V8.965zm8.136 7.58h1.844V8.349H13.46l6.105 5.54v2.655zm-8.982-8.28H2.59v8.195h1.8v-2.576l6.192-5.62zM5.475 2.476v4.71h5.115l-5.115-4.71zm13.219 0l-5.115 4.71h5.115v-4.71z\" fill=\"currentColor\" fill-rule=\"evenodd\"/>\n</svg>`;\n\nexport const COPY_ICON = `<svg width=\"16\" height=\"16\" viewBox=\"0 0 24 24\" fill=\"none\" xmlns=\"http://www.w3.org/2000/svg\">\n<title>Copy</title>\n<path d=\"M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z\" fill=\"currentColor\"/>\n</svg>`;\n\n/**\n * Get default icon for LLM ID\n */\nexport function getDefaultIcon(llmId: string): string | undefined {\n  const icons: Record<string, string> = {\n    chatgpt: CHATGPT_ICON,\n    claude: CLAUDE_ICON,\n    gemini: GEMINI_ICON,\n    perplexity: PERPLEXITY_ICON,\n    copy: COPY_ICON,\n  };\n  return icons[llmId.toLowerCase()];\n}\n\n","import type {\n  LLMShareConfig,\n  NormalizedLLMShareConfig,\n  WidgetMode,\n  LLMConfig,\n  LLMAction,\n} from './types';\nimport {\n  CHATGPT_ICON,\n  CLAUDE_ICON,\n  GEMINI_ICON,\n  PERPLEXITY_ICON,\n  COPY_ICON,\n} from '../icons';\n\n/**\n * LLM metadata mapping\n */\nconst LLM_METADATA: Record<string, { label: string; iconSvg: string; urlTemplate?: string }> = {\n  chatgpt: { \n    label: 'ChatGPT', \n    iconSvg: CHATGPT_ICON,\n    urlTemplate: 'https://chat.openai.com/?q={prompt}'\n  },\n  claude: { \n    label: 'Claude', \n    iconSvg: CLAUDE_ICON,\n    urlTemplate: 'https://claude.ai/new?q={prompt}'\n  },\n  gemini: { \n    label: 'Gemini', \n    iconSvg: GEMINI_ICON,\n    urlTemplate: 'https://aistudio.google.com/prompts/new_chat?prompt={prompt}'\n  },\n  perplexity: { \n    label: 'Perplexity', \n    iconSvg: PERPLEXITY_ICON,\n    urlTemplate: 'https://www.perplexity.ai/search?q={prompt}'\n  },\n  copy: {\n    label: 'Copy',\n    iconSvg: COPY_ICON,\n  },\n};\n\n/**\n * Default LLM names\n */\nconst DEFAULT_LLM_NAMES = ['chatgpt', 'claude', 'perplexity', 'copy'];\n\n/**\n * Expand LLM names array into LLMConfig objects\n */\nfunction expandLLMs(llmNames: string[], action: LLMAction): LLMConfig[] {\n  return llmNames.map((name) => {\n    const normalizedName = name.toLowerCase();\n    const metadata = LLM_METADATA[normalizedName];\n    \n    // Special handling for 'copy' LLM - always use 'copy' action\n    const llmAction = normalizedName === 'copy' ? 'copy' : action;\n    \n    if (!metadata) {\n      // Fallback for unknown LLM names\n      return {\n        id: normalizedName,\n        label: name.charAt(0).toUpperCase() + name.slice(1),\n        action: llmAction,\n      };\n    }\n    return {\n      id: normalizedName,\n      label: metadata.label,\n      action: llmAction,\n      iconSvg: metadata.iconSvg,\n      // Include URL template when action is 'link'\n      urlTemplate: llmAction === 'link' ? metadata.urlTemplate : undefined,\n    };\n  });\n}\n\n/**\n * Detect mode based on config\n */\nfunction detectMode(config: LLMShareConfig): WidgetMode {\n  if (config.mode) {\n    return config.mode;\n  }\n  // If siteId/publicKey present, default to hosted\n  if (config.siteId || config.publicKey) {\n    return 'hosted';\n  }\n  // Otherwise standalone\n  return 'standalone';\n}\n\n/**\n * Get default endpoints for hosted mode\n */\nfunction getDefaultEndpoints(mode: WidgetMode): {\n  collector: string | null;\n  share: string | null;\n  redirectBase: string | null;\n} {\n  if (mode === 'hosted') {\n    // Default to your SaaS endpoints (can be overridden)\n    return {\n      collector: 'https://c.getsourced.ai/v1/events',\n      share: 'https://c.getsourced.ai/v1/share',\n      redirectBase: 'https://t.getsourced.ai/s/',\n    };\n  }\n  return {\n    collector: null,\n    share: null,\n    redirectBase: null,\n  };\n}\n\n/**\n * Apply smart defaults to config\n */\nexport function applyDefaults(\n  config: LLMShareConfig\n): NormalizedLLMShareConfig {\n  const mode = detectMode(config);\n  const defaultEndpoints = getDefaultEndpoints(mode);\n  \n  // Get action (default to 'link')\n  const action: LLMAction = config.action ?? 'link';\n  \n  // Expand LLM names to full configs\n  const llmNames = config.llms && config.llms.length > 0 \n    ? config.llms \n    : DEFAULT_LLM_NAMES;\n  const llms = expandLLMs(llmNames, action);\n\n  return {\n    version: config.version || '1',\n    siteId: config.siteId ?? null,\n    publicKey: config.publicKey ?? null,\n    mode,\n    endpoints: {\n      collector:\n        config.endpoints?.collector ?? defaultEndpoints.collector ?? null,\n      share: config.endpoints?.share ?? defaultEndpoints.share ?? null,\n      redirectBase:\n        config.endpoints?.redirectBase ??\n        defaultEndpoints.redirectBase ??\n        null,\n    },\n    widget: {\n      placement: config.widget?.placement ?? 'bottom-left',\n      style: config.widget?.style ?? 'minimal',\n      theme: config.widget?.theme ?? 'auto',\n      zIndex: config.widget?.zIndex ?? 9999,\n      offsetPx: config.widget?.offsetPx ?? 16,\n      backgroundOpacity: config.widget?.backgroundOpacity ?? 0.5,\n      inlineSelector: config.widget?.inlineSelector ?? null,\n      inlineAlignment: config.widget?.inlineAlignment ?? 'left',\n      showOnMobile: config.widget?.showOnMobile ?? true,\n      showOn: {\n        pathPrefix: config.widget?.showOn?.pathPrefix ?? '/',\n        scrollDistance: config.widget?.showOn?.scrollDistance ?? 200,\n        showOnScroll: config.widget?.showOn?.showOnScroll ?? false,\n      },\n      textLabel: {\n        enabled: config.widget?.textLabel?.enabled ?? false,\n        text: config.widget?.textLabel?.text ?? 'Explore with AI',\n        position: config.widget?.textLabel?.position ?? 'top',\n        hideDelay: config.widget?.textLabel?.hideDelay ?? 3000,\n      },\n    },\n    content: {\n      prompt:\n        config.content?.prompt ??\n        'Summarize this page and answer my question:',\n      includePageTitle: config.content?.includePageTitle ?? true,\n      includeSelectedText: config.content?.includeSelectedText ?? true,\n    },\n    llms,\n    tracking: {\n      enabled: config.tracking?.enabled ?? mode !== 'standalone',\n      batch: config.tracking?.batch ?? true,\n      flushIntervalMs: config.tracking?.flushIntervalMs ?? 8000,\n      respectDNT: config.tracking?.respectDNT ?? true,\n    },\n    callbacks: {\n      onEvent: config.callbacks?.onEvent ?? null,\n      onReady: config.callbacks?.onReady ?? null,\n    },\n    debug: {\n      logToConsole: config.debug?.logToConsole ?? false,\n    },\n  };\n}\n\n","import type { LLMShareConfig, NormalizedLLMShareConfig } from './types';\nimport { applyDefaults } from './defaults';\n\n/**\n * Validate and normalize config\n */\nexport function validateConfig(\n  config: unknown\n): NormalizedLLMShareConfig {\n  // Basic type check\n  if (!config || typeof config !== 'object') {\n    throw new Error('LLMShare config must be an object');\n  }\n\n  const configObj = config as LLMShareConfig;\n\n  // Validate mode if provided\n  if (configObj.mode) {\n    const validModes = ['hosted', 'self_hosted', 'standalone'];\n    if (!validModes.includes(configObj.mode)) {\n      throw new Error(\n        `Invalid mode: ${configObj.mode}. Must be one of: ${validModes.join(', ')}`\n      );\n    }\n  }\n\n  // Validate widget placement if provided\n  if (configObj.widget?.placement) {\n    const validPlacements = [\n      'center-right',\n      'center-left',\n      'bottom-right',\n      'bottom-left',\n      'inline',\n    ];\n    if (!validPlacements.includes(configObj.widget.placement)) {\n      throw new Error(\n        `Invalid placement: ${configObj.widget.placement}. Must be one of: ${validPlacements.join(', ')}`\n      );\n    }\n  }\n  \n  // Validate textLabel position if provided\n  if (configObj.widget?.textLabel?.position) {\n    const validPositions = ['left', 'right', 'top'];\n    if (!validPositions.includes(configObj.widget.textLabel.position)) {\n      throw new Error(\n        `Invalid textLabel position: ${configObj.widget.textLabel.position}. Must be one of: ${validPositions.join(', ')}`\n      );\n    }\n  }\n\n  // Validate widget style if provided\n  if (configObj.widget?.style) {\n    const validStyles = ['pill', 'square', 'minimal', 'custom'];\n    if (!validStyles.includes(configObj.widget.style)) {\n      throw new Error(\n        `Invalid style: ${configObj.widget.style}. Must be one of: ${validStyles.join(', ')}`\n      );\n    }\n  }\n\n  // Validate widget theme if provided\n  if (configObj.widget?.theme) {\n    const validThemes = ['auto', 'light', 'dark'];\n    if (!validThemes.includes(configObj.widget.theme)) {\n      throw new Error(\n        `Invalid theme: ${configObj.widget.theme}. Must be one of: ${validThemes.join(', ')}`\n      );\n    }\n  }\n\n  // Validate action if provided\n  if (configObj.action) {\n    if (!['copy', 'link'].includes(configObj.action)) {\n      throw new Error(`Invalid action: ${configObj.action}. Must be 'copy' or 'link'`);\n    }\n  }\n\n  // Validate LLMs if provided\n  if (configObj.llms) {\n    if (!Array.isArray(configObj.llms)) {\n      throw new Error('llms must be an array');\n    }\n    for (const llm of configObj.llms) {\n      if (typeof llm !== 'string') {\n        throw new Error('Each LLM must be a string (LLM name)');\n      }\n    }\n  }\n\n  // Apply defaults and return normalized config\n  return applyDefaults(configObj);\n}\n\n/**\n * Get config from window.LLMShare\n */\nexport function getConfig(): NormalizedLLMShareConfig | null {\n  if (typeof window === 'undefined') {\n    return null;\n  }\n\n  const windowWithConfig = window as typeof window & {\n    LLMShare?: LLMShareConfig;\n  };\n\n  if (!windowWithConfig.LLMShare) {\n    return null;\n  }\n\n  try {\n    return validateConfig(windowWithConfig.LLMShare);\n  } catch (error) {\n    console.error('[LLMShare] Config validation error:', error);\n    return null;\n  }\n}\n\n","/**\n * Generate UUID v4\n */\nexport function generateUUID(): string {\n  // Simple UUID v4 implementation\n  return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, (c) => {\n    const r = (Math.random() * 16) | 0;\n    const v = c === 'x' ? r : (r & 0x3) | 0x8;\n    return v.toString(16);\n  });\n}\n\n","import type {\n  LLMShareEvent,\n  EventType,\n  ImpressionEvent,\n  ClickEvent,\n  ShareCreatedEvent,\n  FallbackRawUrlEvent,\n  ErrorEvent,\n} from './types';\nimport type { NormalizedLLMShareConfig } from '../config/types';\nimport { generateUUID } from '../utils/uuid';\n\n/**\n * Event tracker - handles event creation, batching, and sending\n */\nexport class EventTracker {\n  private config: NormalizedLLMShareConfig;\n  private viewId: string;\n  private eventQueue: LLMShareEvent[] = [];\n  private flushTimer: number | null = null;\n  private unloadHandler: (() => void) | null = null;\n\n  constructor(config: NormalizedLLMShareConfig) {\n    this.config = config;\n    this.viewId = generateUUID();\n    this.setupUnloadHandler();\n  }\n\n  /**\n   * Create base event object\n   */\n  private createBaseEvent(eventType: EventType): Partial<LLMShareEvent> {\n    return {\n      event_id: generateUUID(),\n      ts: new Date().toISOString(),\n      event_type: eventType,\n      site_id: this.config.siteId || null,\n      page_url: typeof window !== 'undefined' ? window.location.href : '',\n      view_id: this.viewId,\n      mode: this.config.mode,\n    };\n  }\n\n  /**\n   * Emit an event\n   */\n  emit(event: LLMShareEvent): void {\n    // Send to callback if provided\n    if (this.config.callbacks.onEvent) {\n      try {\n        this.config.callbacks.onEvent(event);\n      } catch (error) {\n        if (this.config.debug.logToConsole) {\n          console.error('[LLMShare] Error in onEvent callback:', error);\n        }\n      }\n    }\n\n    // Log to console if debug mode enabled\n    if (this.config.debug.logToConsole) {\n      console.log('[LLMShare] Event:', event);\n    }\n\n    // Queue for batch send if tracking enabled\n    if (this.config.tracking.enabled && this.config.endpoints.collector) {\n      this.eventQueue.push(event);\n      this.scheduleFlush();\n    }\n  }\n\n  /**\n   * Track impression (widget rendered)\n   */\n  trackImpression(): void {\n    const event: ImpressionEvent = {\n      ...this.createBaseEvent('impression'),\n    } as ImpressionEvent;\n    this.emit(event);\n  }\n\n  /**\n   * Track click (LLM button clicked)\n   */\n  trackClick(llmId: string): void {\n    const event: ClickEvent = {\n      ...this.createBaseEvent('click'),\n      llm_id: llmId,\n    } as ClickEvent;\n    this.emit(event);\n  }\n\n  /**\n   * Track share created (share endpoint returned token/url)\n   */\n  trackShareCreated(\n    llmId: string,\n    shareUrl?: string,\n    shareToken?: string\n  ): void {\n    const event: ShareCreatedEvent = {\n      ...this.createBaseEvent('share_created'),\n      llm_id: llmId,\n      share_url: shareUrl,\n      share_token: shareToken,\n    } as ShareCreatedEvent;\n    this.emit(event);\n  }\n\n  /**\n   * Track fallback to raw URL (share failed)\n   */\n  trackFallbackRawUrl(llmId: string, rawUrl: string): void {\n    const event: FallbackRawUrlEvent = {\n      ...this.createBaseEvent('fallback_raw_url'),\n      llm_id: llmId,\n      raw_url: rawUrl,\n    } as FallbackRawUrlEvent;\n    this.emit(event);\n  }\n\n  /**\n   * Track error (non-fatal issues)\n   */\n  trackError(errorMessage: string, errorType?: string): void {\n    const event: ErrorEvent = {\n      ...this.createBaseEvent('error'),\n      error_message: errorMessage,\n      error_type: errorType,\n    } as ErrorEvent;\n    this.emit(event);\n  }\n\n  /**\n   * Schedule flush of event queue\n   */\n  private scheduleFlush(): void {\n    if (this.flushTimer !== null) {\n      return; // Already scheduled\n    }\n\n    if (this.config.tracking.batch) {\n      // Use requestIdleCallback if available, otherwise setTimeout\n      if (typeof requestIdleCallback !== 'undefined') {\n        requestIdleCallback(() => {\n          this.flushTimer = null;\n          this.flush();\n        });\n      } else {\n        this.flushTimer = window.setTimeout(() => {\n          this.flushTimer = null;\n          this.flush();\n        }, this.config.tracking.flushIntervalMs);\n      }\n    } else {\n      // Flush immediately if batching disabled\n      this.flush();\n    }\n  }\n\n  /**\n   * Flush event queue to collector endpoint\n   */\n  private async flush(): Promise<void> {\n    if (this.eventQueue.length === 0) {\n      return;\n    }\n\n    // Check DNT if enabled\n    if (\n      this.config.tracking.respectDNT &&\n      typeof navigator !== 'undefined' &&\n      navigator.doNotTrack === '1'\n    ) {\n      this.eventQueue = [];\n      return;\n    }\n\n    const events = [...this.eventQueue];\n    this.eventQueue = [];\n\n    if (!this.config.endpoints.collector) {\n      return;\n    }\n\n    try {\n      const response = await fetch(this.config.endpoints.collector, {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json',\n        },\n        body: JSON.stringify({\n          events,\n          site_id: this.config.siteId,\n          public_key: this.config.publicKey,\n        }),\n        keepalive: true, // Ensure request completes even if page unloads\n      });\n\n      if (!response.ok) {\n        throw new Error(`HTTP ${response.status}: ${response.statusText}`);\n      }\n    } catch (error) {\n      // Silently fail - don't spam console unless debug mode\n      if (this.config.debug.logToConsole) {\n        console.error('[LLMShare] Failed to send events:', error);\n      }\n      // Re-queue events for retry (limit to prevent memory issues)\n      if (this.eventQueue.length < 100) {\n        this.eventQueue.unshift(...events);\n      }\n    }\n  }\n\n  /**\n   * Setup unload handler to flush events on page unload\n   */\n  private setupUnloadHandler(): void {\n    if (typeof window === 'undefined') {\n      return;\n    }\n\n    this.unloadHandler = () => {\n      // Flush immediately on unload\n      if (this.eventQueue.length > 0) {\n        // Use sendBeacon if available for reliable delivery\n        if (\n          typeof navigator !== 'undefined' &&\n          navigator.sendBeacon &&\n          this.config.endpoints.collector\n        ) {\n          const payload = JSON.stringify({\n            events: this.eventQueue,\n            site_id: this.config.siteId,\n            public_key: this.config.publicKey,\n          });\n          navigator.sendBeacon(\n            this.config.endpoints.collector,\n            new Blob([payload], { type: 'application/json' })\n          );\n        } else {\n          // Fallback to sync fetch (blocks unload but ensures delivery)\n          const xhr = new XMLHttpRequest();\n          xhr.open(\n            'POST',\n            this.config.endpoints.collector || '',\n            false\n          );\n          xhr.setRequestHeader('Content-Type', 'application/json');\n          xhr.send(\n            JSON.stringify({\n              events: this.eventQueue,\n              site_id: this.config.siteId,\n              public_key: this.config.publicKey,\n            })\n          );\n        }\n      }\n    };\n\n    window.addEventListener('beforeunload', this.unloadHandler);\n    window.addEventListener('pagehide', this.unloadHandler);\n  }\n\n  /**\n   * Cleanup\n   */\n  destroy(): void {\n    // Flush remaining events\n    this.flush();\n\n    // Remove unload handler\n    if (this.unloadHandler && typeof window !== 'undefined') {\n      window.removeEventListener('beforeunload', this.unloadHandler);\n      window.removeEventListener('pagehide', this.unloadHandler);\n    }\n\n    // Clear flush timer\n    if (this.flushTimer !== null) {\n      clearTimeout(this.flushTimer);\n      this.flushTimer = null;\n    }\n  }\n}\n\n","import type { NormalizedLLMShareConfig } from '../config/types';\nimport { getPreferredColorScheme } from '../utils/browser';\n\n/**\n * Get effective theme (resolve 'auto' to light/dark)\n */\nexport function getEffectiveTheme(config: NormalizedLLMShareConfig): 'light' | 'dark' {\n  if (config.widget.theme === 'auto') {\n    return getPreferredColorScheme();\n  }\n  return config.widget.theme;\n}\n\n/**\n * Generate CSS styles for widget\n */\nexport function generateStyles(config: NormalizedLLMShareConfig): string {\n  const theme = getEffectiveTheme(config);\n  const isDark = theme === 'dark';\n  const opacity = config.widget.backgroundOpacity ?? 1.0;\n\n  // Style-specific adjustments\n  let borderRadius = '8px';\n  const padding = '8px 16px'; // Reduced vertical padding from 12px to 8px\n  \n  if (config.widget.style === 'pill') {\n    borderRadius = '24px';\n  } else if (config.widget.style === 'square') {\n    borderRadius = '0px'; // Truly square corners\n  } else if (config.widget.style === 'minimal') {\n    borderRadius = '4px';\n  }\n\n  // Convert opacity to rgba alpha value\n  // Dark mode always uses solid black for better visibility\n  const backgroundDark = isDark ? '#000000' : `rgba(0, 0, 0, ${opacity})`;\n  const backgroundLight = `rgba(255, 255, 255, ${opacity})`;\n  // Text-right background respects theme\n  const backgroundRight = isDark ? '#000000' : `rgba(255, 255, 255, ${opacity})`;\n\n  return `\n    .llm-share-widget {\n      position: fixed;\n      z-index: ${config.widget.zIndex};\n      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;\n      font-size: 14px;\n      line-height: 1.5;\n      box-sizing: border-box;\n      transition: transform 0.3s ease-out;\n    }\n    \n    .llm-share-widget.scroll-hidden {\n      transform: translateY(100%);\n    }\n    \n    .llm-share-widget-container {\n      display: flex;\n      align-items: center;\n      gap: 12px;\n      background: ${isDark ? backgroundDark : backgroundLight};\n      border: 1px solid ${isDark ? '#999' : '#e5e5e5'};\n      border-radius: ${borderRadius};\n      padding: ${padding};\n      box-shadow: 0 4px 12px rgba(0, 0, 0, ${isDark ? '0.5' : '0.15'});\n      transition: all 0.3s ease-out;\n      width: fit-content;\n      min-height: 40px;\n    }\n    \n    /* Square style: more prominent with stronger border and shadow */\n    .llm-share-widget-container.style-square {\n      border: 2px solid ${isDark ? '#666' : '#ccc'} !important;\n      border-radius: 0px !important;\n      box-shadow: 0 4px 12px rgba(0, 0, 0, ${isDark ? '0.6' : '0.2'}) !important;\n    }\n    \n    /* Minimal style: more subtle with lighter border and less shadow */\n    .llm-share-widget-container.style-minimal {\n      border: 1px solid ${isDark ? '#333' : '#e0e0e0'} !important;\n      box-shadow: 0 2px 6px rgba(0, 0, 0, ${isDark ? '0.3' : '0.1'}) !important;\n    }\n    \n    /* When text label is on the right, respect theme */\n    .llm-share-widget-container.text-right {\n      background: ${backgroundRight};\n      border: 1px solid ${isDark ? '#333' : '#e5e5e5'};\n    }\n    \n    /* Ensure style classes override text-right border */\n    .llm-share-widget-container.text-right.style-square {\n      border: 2px solid ${isDark ? '#666' : '#ccc'} !important;\n    }\n    \n    .llm-share-widget-container.text-right.style-minimal {\n      border: 1px solid ${isDark ? '#333' : '#e0e0e0'} !important;\n    }\n    \n    .llm-share-widget-container.layout-horizontal {\n      flex-direction: row;\n    }\n    \n    .llm-share-widget-container.layout-vertical {\n      flex-direction: column;\n      align-items: flex-start;\n    }\n    \n    .llm-share-text-label {\n      overflow: hidden;\n      transition: width 0.3s ease-out, opacity 0.3s ease-out;\n      width: 0;\n      opacity: 0;\n      display: flex;\n      align-items: center;\n      justify-content: flex-start;\n      height: 24px;\n      margin: 0;\n      padding: 0;\n      white-space: nowrap;\n    }\n    \n    .llm-share-text-label.text-visible {\n      width: var(--text-label-width, 150px);\n      opacity: 1;\n    }\n    \n    .llm-share-widget-container.layout-vertical .llm-share-text-label {\n      width: auto;\n      opacity: 1;\n      transition: opacity 0.3s ease-out;\n      height: auto;\n    }\n    \n    .llm-share-widget-container.layout-vertical .llm-share-text-label.text-visible {\n      width: auto;\n    }\n    \n    .llm-share-text-label span {\n      font-weight: 500;\n      font-size: 14px;\n      color: ${isDark ? '#999' : '#1a1a1a'};\n      white-space: nowrap;\n      display: block;\n      line-height: 1;\n      margin: 0;\n      padding: 0;\n      text-indent: 0;\n    }\n    \n    /* Text color when text label is on the right - respects theme */\n    .llm-share-widget-container.text-right.theme-light .llm-share-text-label span {\n      color: #1a1a1a;\n    }\n    .llm-share-widget-container.text-right.theme-dark .llm-share-text-label span {\n      color: #999;\n    }\n    \n    /* Light theme: black icons and text */\n    .llm-share-widget-container.theme-light .llm-share-icon {\n      color: #1a1a1a !important;\n    }\n    \n    .llm-share-widget-container.theme-light .llm-share-text-label span {\n      color: #1a1a1a !important;\n    }\n    \n    /* Dark theme: white icons and gray text */\n    .llm-share-widget-container.theme-dark .llm-share-icon {\n      color: #ffffff !important;\n    }\n    \n    .llm-share-widget-container.theme-dark .llm-share-text-label span {\n      color: #999 !important;\n    }\n    \n    .llm-share-buttons-wrapper {\n      display: flex;\n      align-items: center;\n      gap: 16px;\n      flex-shrink: 0;\n      height: 24px;\n      margin: 0;\n      padding: 0;\n    }\n    \n    .llm-share-widget.inline {\n      position: static;\n      display: inline-block;\n      width: fit-content;\n      vertical-align: top;\n      margin: 0;\n      padding: 0;\n      line-height: 0;\n    }\n    \n    .llm-share-widget.inline.align-left {\n      margin-right: auto;\n    }\n    \n    .llm-share-widget.inline.align-center {\n      margin-left: auto;\n      margin-right: auto;\n      display: block;\n    }\n    \n    .llm-share-widget.inline.align-right {\n      margin-left: auto;\n      display: block;\n    }\n    \n    /* Ensure inline widget containers have symmetric vertical spacing */\n    .llm-share-widget.inline .llm-share-widget-container {\n      width: fit-content;\n      margin: 0;\n      vertical-align: top;\n      min-height: auto;\n      display: inline-flex;\n    }\n    \n    .llm-share-widget-container {\n      width: fit-content;\n    }\n    \n    .llm-share-button {\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      padding: 0;\n      margin: 0;\n      background: transparent;\n      border: none;\n      cursor: pointer;\n      transition: opacity 0.3s ease;\n      text-decoration: none;\n      line-height: 0;\n      width: 24px;\n      height: 24px;\n      box-sizing: border-box;\n    }\n    \n    .llm-share-button:hover {\n      opacity: 0.8;\n    }\n    \n    .llm-share-button:active {\n      transform: scale(0.95);\n    }\n    \n    /* Only show focus outline for keyboard navigation (not mouse clicks) */\n    .llm-share-button:focus {\n      outline: none;\n    }\n    \n    /* Enhanced focus styles for keyboard navigation (WCAG AA compliant) */\n    .llm-share-button:focus-visible {\n      outline: 3px solid ${isDark ? '#60a5fa' : '#0052cc'};\n      outline-offset: 3px;\n      border-radius: 4px;\n      box-shadow: 0 0 0 1px ${isDark ? 'rgba(96, 165, 250, 0.3)' : 'rgba(0, 82, 204, 0.3)'};\n    }\n    \n    .llm-share-icon {\n      width: 24px;\n      height: 24px;\n      flex-shrink: 0;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      color: ${isDark ? '#ffffff' : '#1a1a1a'};\n      line-height: 0;\n      margin: 0;\n      padding: 0;\n      box-sizing: border-box;\n    }\n    \n    /* Black icons when text label is on the right */\n    .llm-share-widget-container.text-right .llm-share-icon {\n      color: #1a1a1a;\n    }\n    \n    .llm-share-icon svg {\n      width: 100%;\n      height: 100%;\n      display: block;\n      margin: 0;\n      padding: 0;\n      flex-shrink: 0;\n    }\n    \n    .llm-share-icon img {\n      width: 100%;\n      height: 100%;\n      display: block;\n      object-fit: contain;\n      margin: 0;\n      padding: 0;\n      flex-shrink: 0;\n    }\n    \n    .llm-share-label {\n      flex: 1;\n    }\n    \n    @media (max-width: 768px) {\n      .llm-share-icon {\n        width: 20px;\n        height: 20px;\n      }\n      \n      .llm-share-button {\n        width: 20px;\n        height: 20px;\n        min-width: 44px;\n        min-height: 44px;\n        padding: 12px;\n      }\n      \n      .llm-share-buttons-wrapper {\n        gap: 12px;\n      }\n      \n      .llm-share-widget-container {\n        padding: 10px 12px;\n        min-height: 44px;\n      }\n      \n      /* Adjust offset for mobile bottom placements to prevent overlap with browser UI */\n      .llm-share-widget.placement-bottom-left:not(.inline),\n      .llm-share-widget.placement-bottom-right:not(.inline) {\n        bottom: max(env(safe-area-inset-bottom, 0px), 16px) !important;\n      }\n      \n      /* Adjust horizontal positioning for mobile */\n      .llm-share-widget.placement-bottom-left:not(.inline),\n      .llm-share-widget.placement-center-left:not(.inline) {\n        left: max(env(safe-area-inset-left, 0px), 12px) !important;\n      }\n      \n      .llm-share-widget.placement-bottom-right:not(.inline),\n      .llm-share-widget.placement-center-right:not(.inline) {\n        right: max(env(safe-area-inset-right, 0px), 12px) !important;\n      }\n      \n      /* Ensure text label is readable on mobile */\n      .llm-share-text-label span {\n        font-size: 13px;\n      }\n      \n      /* Stack vertically on very small screens if horizontal layout */\n      @media (max-width: 480px) {\n        .llm-share-widget-container.layout-horizontal {\n          flex-wrap: wrap;\n        }\n        \n        .llm-share-widget-container {\n          padding: 8px 10px;\n        }\n        \n        .llm-share-buttons-wrapper {\n          gap: 10px;\n        }\n      }\n    }\n  `;\n}\n\n/**\n * Inject styles into document\n */\nexport function injectStyles(config: NormalizedLLMShareConfig): void {\n  if (typeof document === 'undefined') {\n    return;\n  }\n\n  const styleId = 'llm-share-widget-styles';\n  \n  // Remove existing styles if present\n  const existing = document.getElementById(styleId);\n  if (existing) {\n    existing.remove();\n  }\n\n  // Create and inject style element\n  const style = document.createElement('style');\n  style.id = styleId;\n  style.textContent = generateStyles(config);\n  document.head.appendChild(style);\n}\n\n","/**\n * Browser feature detection utilities\n */\n\n/**\n * Check if browser supports required features\n */\nexport function isBrowserSupported(): boolean {\n  if (typeof window === 'undefined') {\n    return false;\n  }\n\n  // Check for required APIs\n  if (\n    typeof fetch === 'undefined' ||\n    typeof Promise === 'undefined' ||\n    typeof document === 'undefined'\n  ) {\n    return false;\n  }\n\n  return true;\n}\n\n/**\n * Get prefers-color-scheme value\n */\nexport function getPreferredColorScheme(): 'light' | 'dark' {\n  if (typeof window === 'undefined' || !window.matchMedia) {\n    return 'light';\n  }\n\n  if (window.matchMedia('(prefers-color-scheme: dark)').matches) {\n    return 'dark';\n  }\n\n  return 'light';\n}\n\n/**\n * Check if clipboard API is available\n */\nexport function isClipboardAPIAvailable(): boolean {\n  return (\n    typeof navigator !== 'undefined' &&\n    typeof navigator.clipboard !== 'undefined' &&\n    typeof navigator.clipboard.writeText === 'function'\n  );\n}\n\n/**\n * Check if device is mobile based on screen width and user agent\n */\nexport function isMobileDevice(): boolean {\n  if (typeof window === 'undefined') {\n    return false;\n  }\n\n  // Check screen width (most reliable)\n  const isSmallScreen = window.innerWidth <= 768;\n  \n  // Check user agent as secondary indicator\n  // Note: window.opera is a legacy property for very old Opera browsers\n  const userAgent = navigator.userAgent || navigator.vendor || (typeof window !== 'undefined' && 'opera' in window ? String((window as Record<string, unknown>).opera) : '');\n  const isMobileUA = /android|webos|iphone|ipad|ipod|blackberry|iemobile|opera mini/i.test(userAgent.toLowerCase());\n  \n  // Consider it mobile if either condition is true\n  return isSmallScreen || isMobileUA;\n}\n\n","import { isClipboardAPIAvailable } from './browser';\n\n/**\n * Copy text to clipboard with fallback\n */\nexport async function copyToClipboard(text: string): Promise<boolean> {\n  if (typeof navigator === 'undefined') {\n    return false;\n  }\n\n  // Try modern Clipboard API first\n  if (isClipboardAPIAvailable()) {\n    try {\n      await navigator.clipboard.writeText(text);\n      return true;\n    } catch (error) {\n      // Fall through to fallback\n    }\n  }\n\n  // Fallback to execCommand for older browsers\n  if (typeof document !== 'undefined') {\n    try {\n      const textArea = document.createElement('textarea');\n      textArea.value = text;\n      textArea.style.position = 'fixed';\n      textArea.style.left = '-999999px';\n      textArea.style.top = '-999999px';\n      document.body.appendChild(textArea);\n      textArea.focus();\n      textArea.select();\n\n      const success = document.execCommand('copy');\n      document.body.removeChild(textArea);\n\n      return success;\n    } catch (error) {\n      return false;\n    }\n  }\n\n  return false;\n}\n\n","import type { LLMConfig, NormalizedLLMShareConfig } from '../config/types';\nimport { copyToClipboard } from '../utils/clipboard';\nimport { composePrompt } from '../utils/prompt';\nimport type { EventTracker } from '../events/tracker';\nimport { createShareUrl } from '../utils/share';\n\n/**\n * Create LLM button element\n */\nexport function createLLMButton(\n  llm: LLMConfig,\n  config: NormalizedLLMShareConfig,\n  tracker: EventTracker,\n  _container: HTMLElement\n): HTMLElement {\n  // Use anchor tag for link actions, button for copy actions\n  const element = llm.action === 'link' && llm.urlTemplate\n    ? document.createElement('a')\n    : document.createElement('button');\n  \n  element.className = 'llm-share-button';\n  \n  // Set aria-label based on action type\n  const ariaLabel = llm.action === 'copy'\n    ? `Copy page content to ${llm.label}`\n    : `Open current page in ${llm.label} to ask questions`;\n  element.setAttribute('aria-label', ariaLabel);\n  \n  if (element instanceof HTMLButtonElement) {\n    element.setAttribute('type', 'button');\n  } else if (element instanceof HTMLAnchorElement) {\n    element.setAttribute('rel', 'noopener noreferrer');\n    element.setAttribute('target', '_blank');\n    element.setAttribute('title', llm.label);\n  }\n\n  // Add icon if available\n  if (llm.iconSvg) {\n    const iconContainer = document.createElement('span');\n    iconContainer.className = 'llm-share-icon';\n    iconContainer.setAttribute('aria-hidden', 'true'); // Decorative icon, hidden from screen readers\n    iconContainer.innerHTML = llm.iconSvg;\n    element.appendChild(iconContainer);\n  } else if (llm.iconUrl) {\n    const icon = document.createElement('img');\n    icon.className = 'llm-share-icon';\n    icon.src = llm.iconUrl;\n    icon.alt = `${llm.label} icon`;\n    element.appendChild(icon);\n  }\n\n  // Don't show labels by default - icon-only mode for ExploreWithAI style\n  // Labels can be shown by setting widget.style to something other than 'minimal'\n  // or by explicitly configuring showLabels in the future\n\n  // Handle click or set href\n  if (llm.action === 'link' && llm.urlTemplate && element instanceof HTMLAnchorElement) {\n    // Generate URL immediately for link actions\n    const url = generateLLMUrl(llm, config);\n    if (config.debug.logToConsole) {\n      console.log(`[LLMShare] Generated URL for ${llm.id}:`, url);\n    }\n    if (url) {\n      element.href = url;\n      // Add click handler to track and ensure link opens\n      element.addEventListener('click', (e) => {\n        // Track click\n        tracker.trackClick(llm.id);\n        // Use window.open to ensure it opens in new tab\n        e.preventDefault();\n        const opened = window.open(url, '_blank', 'noopener,noreferrer');\n        if (!opened && config.debug.logToConsole) {\n          console.warn(`[LLMShare] Failed to open ${llm.id} link - popup may be blocked`);\n        }\n      });\n    } else {\n      // If URL generation fails, fall back to button behavior\n      const button = document.createElement('button');\n      button.className = element.className;\n      button.setAttribute('type', 'button');\n      // Preserve the aria-label from the element (which is already set for link action)\n      button.setAttribute('aria-label', element.getAttribute('aria-label') || `Open current page in ${llm.label} to ask questions`);\n      // Copy children\n      while (element.firstChild) {\n        button.appendChild(element.firstChild);\n      }\n      if (element.parentNode) {\n        element.parentNode.replaceChild(button, element);\n      }\n      button.addEventListener('click', async (e) => {\n        e.preventDefault();\n        await handleLLMClick(llm, config, tracker, button);\n      });\n      return button;\n    }\n  } else {\n    element.addEventListener('click', async (e) => {\n      e.preventDefault();\n      await handleLLMClick(llm, config, tracker, element);\n    });\n  }\n\n  return element;\n}\n\n/**\n * Generate LLM URL with prompt\n */\nfunction generateLLMUrl(\n  llm: LLMConfig,\n  _config: NormalizedLLMShareConfig\n): string | null {\n  if (!llm.urlTemplate) {\n    return null;\n  }\n\n  const currentUrl = window.location.href;\n  const path = window.location.pathname || '/';\n  \n  // Generate prompt similar to ExploreWithAI component\n  const prompt = encodeURIComponent(\n    `Provide a detailed summary of ${currentUrl} so I can ask questions about it`\n  );\n\n  // Replace placeholders in URL template (if they exist)\n  let url = llm.urlTemplate;\n  if (url.includes('{url}')) {\n    url = url.replace('{url}', encodeURIComponent(currentUrl));\n  }\n  if (url.includes('{prompt}')) {\n    url = url.replace('{prompt}', prompt);\n  }\n  if (url.includes('{path}')) {\n    url = url.replace('{path}', encodeURIComponent(path));\n  }\n\n  return url;\n}\n\n/**\n * Get or create live region for accessibility announcements\n */\nfunction getLiveRegion(): HTMLElement {\n  let liveRegion = document.getElementById('llm-share-live-region');\n  if (!liveRegion) {\n    liveRegion = document.createElement('div');\n    liveRegion.id = 'llm-share-live-region';\n    liveRegion.setAttribute('role', 'status');\n    liveRegion.setAttribute('aria-live', 'polite');\n    liveRegion.setAttribute('aria-atomic', 'true');\n    liveRegion.className = 'llm-share-live-region';\n    // Visually hidden but accessible to screen readers\n    liveRegion.style.position = 'absolute';\n    liveRegion.style.left = '-10000px';\n    liveRegion.style.width = '1px';\n    liveRegion.style.height = '1px';\n    liveRegion.style.overflow = 'hidden';\n    document.body.appendChild(liveRegion);\n  }\n  return liveRegion;\n}\n\n/**\n * Announce message to screen readers\n */\nfunction announceToScreenReader(message: string): void {\n  const liveRegion = getLiveRegion();\n  liveRegion.textContent = message;\n  // Clear after announcement to allow re-announcement of same message\n  setTimeout(() => {\n    liveRegion.textContent = '';\n  }, 1000);\n}\n\n/**\n * Handle LLM button click\n */\nasync function handleLLMClick(\n  llm: LLMConfig,\n  config: NormalizedLLMShareConfig,\n  tracker: EventTracker,\n  buttonElement?: HTMLElement\n): Promise<void> {\n  // Track click\n  tracker.trackClick(llm.id);\n\n  const currentUrl = window.location.href;\n\n  if (llm.action === 'copy') {\n    // Try to create share URL first (if endpoint available)\n    let finalUrl = currentUrl;\n    \n    if (config.endpoints.share) {\n      try {\n        const shareUrl = await createShareUrl(\n          currentUrl,\n          config.endpoints.share,\n          config.siteId,\n          config.publicKey\n        );\n        if (shareUrl) {\n          finalUrl = shareUrl;\n          tracker.trackShareCreated(llm.id, shareUrl);\n        } else {\n          tracker.trackFallbackRawUrl(llm.id, currentUrl);\n        }\n      } catch (error) {\n        tracker.trackFallbackRawUrl(llm.id, currentUrl);\n      }\n    }\n\n    // Compose prompt\n    const prompt = composePrompt(config, finalUrl);\n\n    // Copy to clipboard\n    const success = await copyToClipboard(prompt);\n    \n    if (success) {\n      // Announce success to screen readers\n      announceToScreenReader(`Content copied to clipboard for ${llm.label}`);\n      \n      // Restore focus to button for keyboard users\n      if (buttonElement && typeof buttonElement.focus === 'function') {\n        // Use setTimeout to ensure clipboard operation completes first\n        setTimeout(() => {\n          buttonElement.focus();\n        }, 100);\n      }\n      \n      if (config.debug.logToConsole) {\n        console.log('[LLMShare] Copied to clipboard:', prompt);\n      }\n    } else {\n      // Announce failure to screen readers\n      announceToScreenReader(`Failed to copy content to clipboard for ${llm.label}`);\n      \n      tracker.trackError('Failed to copy to clipboard', 'clipboard_error');\n      if (config.debug.logToConsole) {\n        console.error('[LLMShare] Failed to copy to clipboard');\n      }\n    }\n  } else if (llm.action === 'link' && llm.urlTemplate) {\n    const url = generateLLMUrl(llm, config);\n    if (url) {\n      window.open(url, '_blank', 'noopener,noreferrer');\n    }\n  }\n}\n\n","/**\n * Create share URL via endpoint\n */\nexport async function createShareUrl(\n  url: string,\n  shareEndpoint: string,\n  siteId: string | null,\n  publicKey: string | null\n): Promise<string | null> {\n  try {\n    const response = await fetch(shareEndpoint, {\n      method: 'POST',\n      headers: {\n        'Content-Type': 'application/json',\n      },\n      body: JSON.stringify({\n        url,\n        site_id: siteId,\n        public_key: publicKey,\n      }),\n    });\n\n    if (!response.ok) {\n      throw new Error(`HTTP ${response.status}: ${response.statusText}`);\n    }\n\n    const data = await response.json();\n    \n    // Expect response with token or url\n    if (data.token && data.redirect_base) {\n      return `${data.redirect_base}${data.token}`;\n    } else if (data.url) {\n      return data.url;\n    } else if (data.share_url) {\n      return data.share_url;\n    }\n\n    return null;\n  } catch (error) {\n    // Silently fail - will fallback to raw URL\n    return null;\n  }\n}\n\n","import type { NormalizedLLMShareConfig } from '../config/types';\n\n/**\n * Compose prompt text with page information\n */\nexport function composePrompt(\n  config: NormalizedLLMShareConfig,\n  url: string\n): string {\n  const parts: string[] = [];\n\n  // Add prompt template\n  if (config.content.prompt) {\n    parts.push(config.content.prompt);\n  }\n\n  // Add page title if enabled\n  if (config.content.includePageTitle && typeof document !== 'undefined') {\n    const title = document.title || '';\n    if (title) {\n      parts.push(`\\n\\nPage: ${title}`);\n    }\n  }\n\n  // Add selected text if enabled and present\n  if (\n    config.content.includeSelectedText &&\n    typeof window !== 'undefined' &&\n    window.getSelection\n  ) {\n    const selection = window.getSelection();\n    if (selection && selection.toString().trim()) {\n      const selectedText = selection.toString().trim();\n      if (selectedText.length > 0 && selectedText.length < 1000) {\n        // Limit selected text length\n        parts.push(`\\n\\nSelected text: ${selectedText}`);\n      }\n    }\n  }\n\n  // Add URL\n  parts.push(`\\n\\nURL: ${url}`);\n\n  return parts.join('');\n}\n\n","import type { NormalizedLLMShareConfig } from '../config/types';\nimport type { EventTracker } from '../events/tracker';\nimport { injectStyles, getEffectiveTheme } from './styles';\nimport { createLLMButton } from './Button';\nimport { isBrowserSupported, isMobileDevice } from '../utils/browser';\n\n/**\n * Widget container class\n */\nexport class Widget {\n  private config: NormalizedLLMShareConfig;\n  private tracker: EventTracker;\n  private container: HTMLElement | null = null;\n  private isInitialized = false;\n  private isVisible = false;\n  private showTextInitially = true;\n  private scrollRafRef: number | null = null;\n  private textContainer: HTMLElement | null = null;\n  private scrollHandler: (() => void) | null = null;\n\n  constructor(config: NormalizedLLMShareConfig, tracker: EventTracker) {\n    this.config = config;\n    this.tracker = tracker;\n  }\n\n  /**\n   * Initialize and render widget\n   */\n  init(): void {\n    if (this.isInitialized) {\n      return;\n    }\n\n    // Check browser support\n    if (!isBrowserSupported()) {\n      if (this.config.debug.logToConsole) {\n        console.warn('[LLMShare] Browser not supported');\n      }\n      return;\n    }\n\n    // Check if widget should be shown on this page\n    if (!this.shouldShow()) {\n      return;\n    }\n\n    // Inject styles\n    injectStyles(this.config);\n\n    // Create container\n    this.container = this.createContainer();\n\n    // Render LLM buttons\n    this.renderButtons();\n\n    // Append to DOM\n    this.appendToDOM();\n\n    // Setup scroll detection if enabled\n    this.setupScrollDetection();\n\n    // Track impression\n    this.tracker.trackImpression();\n\n    // Call onReady callback\n    if (this.config.callbacks.onReady) {\n      try {\n        this.config.callbacks.onReady();\n      } catch (error) {\n        if (this.config.debug.logToConsole) {\n          console.error('[LLMShare] Error in onReady callback:', error);\n        }\n      }\n    }\n\n    this.isInitialized = true;\n  }\n\n  /**\n   * Check if widget should be shown on current page\n   */\n  private shouldShow(): boolean {\n    if (typeof window === 'undefined') {\n      return false;\n    }\n\n    // Check mobile visibility flag\n    if (!this.config.widget.showOnMobile && isMobileDevice()) {\n      return false;\n    }\n\n    const pathPrefix = this.config.widget.showOn.pathPrefix;\n    if (pathPrefix && pathPrefix !== '/') {\n      const currentPath = window.location.pathname;\n      if (!currentPath.startsWith(pathPrefix)) {\n        return false;\n      }\n    }\n\n    return true;\n  }\n\n  /**\n   * Create widget container element\n   */\n  private createContainer(): HTMLElement {\n    const container = document.createElement('div');\n    container.className = 'llm-share-widget';\n    container.setAttribute('role', 'region');\n    container.setAttribute('aria-label', 'AI assistant options');\n\n    // Handle inline vs overlay mode\n    if (this.config.widget.placement === 'inline' && this.config.widget.inlineSelector) {\n      container.classList.add('inline');\n      // Add alignment class\n      const alignment = this.config.widget.inlineAlignment ?? 'left';\n      container.classList.add(`align-${alignment}`);\n      return container;\n    }\n\n    // Overlay mode - set position\n    container.style.position = 'fixed';\n    \n    // Add placement class for CSS targeting\n    container.classList.add(`placement-${this.config.widget.placement}`);\n    \n    if (this.config.widget.placement === 'center-right') {\n      container.style.right = `${this.config.widget.offsetPx}px`;\n      container.style.top = '50%';\n      container.style.transform = 'translateY(-50%)';\n    } else if (this.config.widget.placement === 'center-left') {\n      container.style.left = `${this.config.widget.offsetPx}px`;\n      container.style.top = '50%';\n      container.style.transform = 'translateY(-50%)';\n    } else if (this.config.widget.placement === 'bottom-right') {\n      container.style.right = `${this.config.widget.offsetPx}px`;\n      container.style.bottom = `${this.config.widget.offsetPx}px`;\n    } else if (this.config.widget.placement === 'bottom-left') {\n      container.style.left = `${this.config.widget.offsetPx}px`;\n      container.style.bottom = `${this.config.widget.offsetPx}px`;\n      // Add initial hidden state if scroll-based visibility is enabled\n      if (this.config.widget.showOn?.showOnScroll) {\n        container.classList.add('scroll-hidden');\n      }\n    }\n\n    return container;\n  }\n\n  /**\n   * Setup scroll detection for widget visibility\n   */\n  private setupScrollDetection(): void {\n    if (!this.config.widget.showOn?.showOnScroll || !this.container) {\n      return;\n    }\n\n    const scrollDistance = this.config.widget.showOn.scrollDistance ?? 200;\n\n    this.scrollHandler = () => {\n      if (this.scrollRafRef !== null) {\n        cancelAnimationFrame(this.scrollRafRef);\n      }\n\n      this.scrollRafRef = requestAnimationFrame(() => {\n        const scrollY = window.scrollY || window.pageYOffset;\n        const shouldBeVisible = scrollY > scrollDistance;\n        \n        if (shouldBeVisible !== this.isVisible) {\n          this.isVisible = shouldBeVisible;\n          if (this.container) {\n            if (shouldBeVisible) {\n              this.container.classList.remove('scroll-hidden');\n              // Start text hide timer when widget becomes visible\n              this.startTextHideTimer();\n            } else {\n              this.container.classList.add('scroll-hidden');\n              this.showTextInitially = true; // Reset text visibility\n              if (this.textContainer) {\n                this.textContainer.classList.add('text-visible');\n              }\n            }\n          }\n        }\n      });\n    };\n\n    // Initial check\n    if (this.scrollHandler) {\n      this.scrollHandler();\n      // If widget is already visible after initial check, start timer\n      if (this.isVisible && this.config.widget.textLabel?.enabled) {\n        const textPosition = this.config.widget.textLabel?.position ?? 'right';\n        const isHorizontal = textPosition === 'left' || textPosition === 'right';\n        if (isHorizontal) {\n          this.startTextHideTimer();\n        }\n      }\n    }\n\n    window.addEventListener('scroll', this.scrollHandler, { passive: true });\n  }\n\n  /**\n   * Start timer to hide text label\n   */\n  private startTextHideTimer(): void {\n    if (!this.config.widget.textLabel?.enabled) {\n      return;\n    }\n\n    const hideDelay = this.config.widget.textLabel.hideDelay ?? 3000;\n    \n    setTimeout(() => {\n      this.showTextInitially = false;\n      if (this.textContainer) {\n        this.textContainer.classList.remove('text-visible');\n      }\n    }, hideDelay);\n  }\n\n  /**\n   * Create text label element\n   */\n  private createTextLabel(): HTMLElement | null {\n    if (!this.config.widget.textLabel?.enabled) {\n      return null;\n    }\n\n    const textLabel = this.config.widget.textLabel.text ?? 'Explore with AI';\n    const textContainer = document.createElement('div');\n    textContainer.className = 'llm-share-text-label';\n    \n    const textSpan = document.createElement('span');\n    textSpan.textContent = textLabel;\n    textContainer.appendChild(textSpan);\n\n    // Measure text width and set CSS variable for smooth transition\n    // Use canvas to measure text width accurately\n    const canvas = document.createElement('canvas');\n    const context = canvas.getContext('2d');\n    if (context) {\n      context.font = '500 14px -apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Oxygen, Ubuntu, Cantarell, sans-serif';\n      const textWidth = Math.ceil(context.measureText(textLabel).width);\n      textContainer.style.setProperty('--text-label-width', `${textWidth}px`);\n    } else {\n      // Fallback: create temporary span to measure\n      const tempSpan = document.createElement('span');\n      tempSpan.style.visibility = 'hidden';\n      tempSpan.style.position = 'absolute';\n      tempSpan.style.top = '-9999px';\n      tempSpan.style.fontWeight = '500';\n      tempSpan.style.fontSize = '14px';\n      tempSpan.style.fontFamily = '-apple-system, BlinkMacSystemFont, \"Segoe UI\", Roboto, Oxygen, Ubuntu, Cantarell, sans-serif';\n      tempSpan.style.whiteSpace = 'nowrap';\n      tempSpan.textContent = textLabel;\n      document.body.appendChild(tempSpan);\n      const textWidth = Math.ceil(tempSpan.offsetWidth);\n      document.body.removeChild(tempSpan);\n      textContainer.style.setProperty('--text-label-width', `${textWidth}px`);\n    }\n    textContainer.classList.add('text-visible');\n    this.textContainer = textContainer;\n    return textContainer;\n  }\n\n  /**\n   * Render LLM buttons\n   */\n  private renderButtons(): void {\n    if (!this.container) {\n      return;\n    }\n\n    const buttonContainer = document.createElement('div');\n    buttonContainer.className = 'llm-share-widget-container';\n    \n    // Add style class for CSS targeting\n    buttonContainer.classList.add(`style-${this.config.widget.style}`);\n    \n    // Add theme class for CSS targeting\n    const theme = getEffectiveTheme(this.config);\n    buttonContainer.classList.add(`theme-${theme}`);\n    \n    // Determine text position\n    const textPosition = this.config.widget.textLabel?.position ?? 'right';\n    const isHorizontal = textPosition === 'left' || textPosition === 'right';\n    const isRight = textPosition === 'right';\n    \n    if (isHorizontal) {\n      buttonContainer.classList.add('layout-horizontal');\n      if (isRight) {\n        buttonContainer.classList.add('text-right');\n      }\n    } else {\n      buttonContainer.classList.add('layout-vertical');\n    }\n\n    // Create buttons wrapper\n    const buttonsWrapper = document.createElement('div');\n    buttonsWrapper.className = 'llm-share-buttons-wrapper';\n    buttonsWrapper.setAttribute('role', 'group');\n    buttonsWrapper.setAttribute('aria-label', 'AI assistant buttons');\n\n    for (const llm of this.config.llms) {\n      const button = createLLMButton(llm, this.config, this.tracker, buttonsWrapper);\n      buttonsWrapper.appendChild(button);\n    }\n\n    // Add text label if enabled\n    const textLabel = this.createTextLabel();\n    \n    if (textLabel && isHorizontal) {\n      if (isRight) {\n        // Text on the right - add after buttons\n        buttonContainer.appendChild(buttonsWrapper);\n        buttonContainer.appendChild(textLabel);\n      } else {\n        // Text on the left - add before buttons\n        buttonContainer.appendChild(textLabel);\n        buttonContainer.appendChild(buttonsWrapper);\n      }\n    } else if (textLabel && !isHorizontal) {\n      // Vertical layout - text on top\n      buttonContainer.appendChild(buttonsWrapper);\n      buttonContainer.insertBefore(textLabel, buttonsWrapper);\n    } else {\n      // No text label\n      buttonContainer.appendChild(buttonsWrapper);\n    }\n\n    this.container.appendChild(buttonContainer);\n\n    // Setup hover for text expansion (only for horizontal layout)\n    if (textLabel && this.config.widget.textLabel?.enabled && isHorizontal) {\n      buttonContainer.addEventListener('mouseenter', () => {\n        if (!this.showTextInitially && this.textContainer) {\n          this.textContainer.classList.add('text-visible');\n        }\n      });\n\n      buttonContainer.addEventListener('mouseleave', () => {\n        if (!this.showTextInitially && this.textContainer) {\n          this.textContainer.classList.remove('text-visible');\n        }\n      });\n      \n      // Start hide timer for horizontal layouts (only if widget is visible)\n      // If scroll detection is enabled, the timer will start when widget becomes visible\n      if (!this.config.widget.showOn?.showOnScroll || !this.container?.classList.contains('scroll-hidden')) {\n        this.startTextHideTimer();\n      }\n    }\n    \n    this.container.appendChild(buttonContainer);\n  }\n\n  /**\n   * Append widget to DOM\n   */\n  private appendToDOM(): void {\n    if (!this.container || typeof document === 'undefined') {\n      return;\n    }\n\n    // Inline mode - find target element\n    if (this.config.widget.placement === 'inline' && this.config.widget.inlineSelector) {\n      const target = document.querySelector(this.config.widget.inlineSelector);\n      if (target) {\n        // Add alignment class to parent container if it exists\n        const alignment = this.config.widget.inlineAlignment ?? 'left';\n        if (target instanceof HTMLElement) {\n          target.classList.add(`align-${alignment}`);\n        }\n        target.appendChild(this.container);\n        return;\n      }\n    }\n\n    // Overlay mode - append to body\n    document.body.appendChild(this.container);\n  }\n\n  /**\n   * Destroy widget\n   */\n  destroy(): void {\n    if (this.scrollRafRef !== null) {\n      cancelAnimationFrame(this.scrollRafRef);\n    }\n    \n    if (this.scrollHandler) {\n      window.removeEventListener('scroll', this.scrollHandler);\n    }\n    \n    if (this.container && this.container.parentNode) {\n      this.container.parentNode.removeChild(this.container);\n    }\n    this.container = null;\n    this.textContainer = null;\n    this.isInitialized = false;\n    this.isVisible = false;\n    this.showTextInitially = true;\n  }\n}\n\n","/**\n * Main widget entry point\n */\n\nimport type { LLMShareConfig } from './config/types';\nimport { getConfig } from './config/schema';\nimport { EventTracker } from './events/tracker';\nimport { Widget } from './ui/Widget';\nimport { getDefaultIcon } from './icons';\n\nimport { validateConfig } from './config/schema';\n\n/**\n * Initialize widget\n */\nexport function init(config?: LLMShareConfig): void {\n  // Get config from window or parameter\n  let normalizedConfig;\n  \n  if (config) {\n    // Config passed directly (from loader)\n    normalizedConfig = validateConfig(config);\n  } else {\n    // Get from window\n    normalizedConfig = getConfig();\n  }\n\n  if (!normalizedConfig) {\n    console.error('[LLMShare] Failed to initialize: invalid or missing config');\n    return;\n  }\n\n  // Add default icons to LLM configs if not provided\n  for (const llm of normalizedConfig.llms) {\n    if (!llm.iconSvg && !llm.iconUrl) {\n      const defaultIcon = getDefaultIcon(llm.id);\n      if (defaultIcon) {\n        llm.iconSvg = defaultIcon;\n      }\n    }\n  }\n\n  // Create event tracker\n  const tracker = new EventTracker(normalizedConfig);\n\n  // Create and initialize widget\n  const widget = new Widget(normalizedConfig, tracker);\n  widget.init();\n\n  // Expose widget instance for cleanup if needed\n  if (typeof window !== 'undefined') {\n    window.__LLMShareInstance = {\n      widget,\n      tracker,\n      destroy: () => {\n        widget.destroy();\n        tracker.destroy();\n        delete window.__LLMShareInstance;\n      },\n    };\n  }\n}\n\n// Export for UMD/IIFE builds\nif (typeof window !== 'undefined') {\n  window.LLMShareWidget = {\n    init,\n  };\n  \n  // Auto-init if config exists and DOM is ready (for direct script inclusion)\n  // But only if loader hasn't already initialized\n  if (window.LLMShare && !window.__LLMShareInitialized) {\n    const doInit = () => {\n      if (!window.__LLMShareInitialized) {\n        window.__LLMShareInitialized = true;\n        init();\n      }\n    };\n    \n    if (typeof document !== 'undefined') {\n      if (document.readyState === 'loading') {\n        document.addEventListener('DOMContentLoaded', doInit);\n      } else {\n        doInit();\n      }\n    }\n  }\n}\n\n"],"names":["CHATGPT_ICON","CLAUDE_ICON","GEMINI_ICON","PERPLEXITY_ICON","COPY_ICON","getDefaultIcon","llmId","chatgpt","claude","gemini","perplexity","copy","toLowerCase","LLM_METADATA","label","iconSvg","urlTemplate","DEFAULT_LLM_NAMES","applyDefaults","config","mode","siteId","publicKey","detectMode","defaultEndpoints","collector","share","redirectBase","getDefaultEndpoints","action","llms","llmNames","map","name","normalizedName","metadata","llmAction","id","charAt","toUpperCase","slice","expandLLMs","length","version","endpoints","widget","placement","style","theme","zIndex","offsetPx","backgroundOpacity","inlineSelector","inlineAlignment","showOnMobile","showOn","pathPrefix","scrollDistance","showOnScroll","textLabel","enabled","text","position","hideDelay","content","prompt","includePageTitle","includeSelectedText","tracking","batch","flushIntervalMs","respectDNT","callbacks","onEvent","onReady","debug","logToConsole","validateConfig","Error","configObj","validModes","includes","join","validPlacements","validPositions","validStyles","validThemes","Array","isArray","llm","generateUUID","replace","c","r","Math","random","toString","EventTracker","constructor","this","eventQueue","flushTimer","unloadHandler","viewId","setupUnloadHandler","createBaseEvent","eventType","event_id","ts","Date","toISOString","event_type","site_id","page_url","window","location","href","view_id","emit","event","error","console","log","push","scheduleFlush","trackImpression","trackClick","llm_id","trackShareCreated","shareUrl","shareToken","share_url","share_token","trackFallbackRawUrl","rawUrl","raw_url","trackError","errorMessage","errorType","error_message","error_type","requestIdleCallback","flush","setTimeout","navigator","doNotTrack","events","response","fetch","method","headers","body","JSON","stringify","public_key","keepalive","ok","status","statusText","unshift","sendBeacon","payload","Blob","type","xhr","XMLHttpRequest","open","setRequestHeader","send","addEventListener","destroy","removeEventListener","clearTimeout","getEffectiveTheme","matchMedia","matches","injectStyles","document","styleId","existing","getElementById","remove","createElement","textContent","isDark","opacity","borderRadius","backgroundDark","backgroundLight","backgroundRight","generateStyles","head","appendChild","async","copyToClipboard","clipboard","writeText","textArea","value","left","top","focus","select","success","execCommand","removeChild","createLLMButton","tracker","_container","element","className","ariaLabel","setAttribute","HTMLButtonElement","HTMLAnchorElement","iconContainer","innerHTML","iconUrl","icon","src","alt","url","generateLLMUrl","button","getAttribute","firstChild","parentNode","replaceChild","e","preventDefault","handleLLMClick","warn","_config","currentUrl","path","pathname","encodeURIComponent","announceToScreenReader","message","liveRegion","width","height","overflow","getLiveRegion","buttonElement","finalUrl","shareEndpoint","data","json","token","redirect_base","createShareUrl","parts","title","getSelection","selection","trim","selectedText","composePrompt","Widget","container","isInitialized","isVisible","showTextInitially","scrollRafRef","textContainer","scrollHandler","init","Promise","shouldShow","createContainer","renderButtons","appendToDOM","setupScrollDetection","isSmallScreen","innerWidth","userAgent","vendor","String","opera","isMobileUA","test","isMobileDevice","startsWith","classList","add","alignment","right","transform","bottom","cancelAnimationFrame","requestAnimationFrame","shouldBeVisible","scrollY","pageYOffset","startTextHideTimer","textPosition","passive","createTextLabel","textSpan","context","getContext","font","textWidth","ceil","measureText","setProperty","tempSpan","visibility","fontWeight","fontSize","fontFamily","whiteSpace","offsetWidth","buttonContainer","isHorizontal","isRight","buttonsWrapper","insertBefore","contains","target","querySelector","HTMLElement","normalizedConfig","windowWithConfig","LLMShare","getConfig","defaultIcon","__LLMShareInstance","LLMShareWidget","__LLMShareInitialized","doInit","readyState"],"mappings":"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"}